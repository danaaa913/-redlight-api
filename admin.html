<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ğŸ›ï¸ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ù‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø²Ø§Ù‡Ø©</title>
  <style>
    * { box-sizing: border-box; }
    body { 
      font-family: 'Segoe UI', Arial, sans-serif; 
      margin: 0; background: #f8f9fa; color: #2c3e50; 
    }
    .container { 
      max-width: 500px; margin: 50px auto; padding: 30px; 
      background: white; border-radius: 15px; 
      box-shadow: 0 8px 25px rgba(0,0,0,0.1); text-align: center; 
    }
    .logo { font-size: 3em; margin-bottom: 10px; }
    h1 { color: #2c3e50; margin-bottom: 30px; }
    .input-group { margin-bottom: 20px; text-align: right; }
    label { display: block; margin-bottom: 8px; font-weight: 600; color: #555; }
    input { 
      width: 100%; padding: 15px; border: 2px solid #ecf0f1; 
      border-radius: 8px; font-size: 16px; box-sizing: border-box; 
    }
    input:focus { outline: none; border-color: #3498db; }
    button { 
      width: 100%; padding: 15px; background: #e74c3c; color: white; 
      border: none; border-radius: 8px; font-size: 16px; cursor: pointer; 
      margin: 10px 0; font-weight: 600; transition: background 0.3s; 
    }
    button:hover { background: #c0392b; }
    button:disabled { background: #bdc3c7; cursor: not-allowed; }
    .success { 
      background: #d4edda; color: #155724; padding: 15px; 
      border-radius: 8px; margin: 20px 0; border: 1px solid #c3e6cb; 
    }
    .error { 
      background: #f8d7da; color: #721c24; padding: 15px; 
      border-radius: 8px; margin: 20px 0; border: 1px solid #f5c6cb; 
    }
    .demo-info { 
      background: #e9ecef; padding: 15px; border-radius: 8px; 
      margin-top: 20px; font-size: 0.9em; color: #666; 
    }
    .dashboard { display: none; }
    .stats-grid { 
      display: grid; grid-template-columns: 1fr 1fr; 
      gap: 15px; margin: 20px 0; 
    }
    .stat-card { 
      background: #f8f9fa; padding: 20px; border-radius: 10px; 
      text-align: center; 
    }
    .stat-number { 
      font-size: 2em; font-weight: bold; margin-bottom: 5px; 
    }
    .high-priority { color: #e74c3c; }
    .medium-priority { color: #f39c12; }
    .low-priority { color: #27ae60; }
    .institution-list { 
      max-height: 300px; overflow-y: auto; 
      border: 1px solid #ddd; border-radius: 8px; padding: 10px; 
    }
    .institution-item { 
      padding: 10px; margin: 5px 0; border-radius: 5px; 
      color: white; font-weight: bold; 
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="loginSection">
      <div class="logo">ğŸ›ï¸</div>
      <h1>Ù‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø²Ø§Ù‡Ø© ÙˆÙ…ÙƒØ§ÙØ­Ø© Ø§Ù„ÙØ³Ø§Ø¯</h1>
      
      <div class="input-group">
        <label for="username">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</label>
        <input type="text" id="username" required>
      </div>
      
      <div class="input-group">
        <label for="password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label>
        <input type="password" id="password" required>
      </div>
      
      <button onclick="login()" id="loginBtn">ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
      
      <div class="demo-info">
        <strong>Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±:</strong><br>
        Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: admin<br>
        ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: integrity2025
      </div>
      
      <div id="loginMessage"></div>
    </div>
    
    <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
    <div id="dashboardSection" class="dashboard">
      <h1>ğŸ›ï¸ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
      
      <div class="success">âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!</div>
      
      <button onclick="loadInstitutions()">ğŸ“Š Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¤Ø³Ø³Ø§Øª</button>
      <button onclick="testAPI()">ğŸ”Œ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…</button>
      <button onclick="showSystemInfo()">ğŸ’¡ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</button>
      <button onclick="logout()">ğŸšª Ø®Ø±ÙˆØ¬</button>
      
      <div id="dashboardResults"></div>
    </div>
  </div>

  <script>
    const API_BASE = 'https://redlight-api.onrender.com';
    let adminToken = null;

    async function login() {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      const messageDiv = document.getElementById('loginMessage');
      const loginBtn = document.getElementById('loginBtn');
      
      if (!username || !password) {
        messageDiv.innerHTML = '<div class="error">âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</div>';
        return;
      }
      
      loginBtn.disabled = true;
      loginBtn.textContent = 'â³ Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...';
      messageDiv.innerHTML = '';
      
      try {
        const response = await fetch(`${API_BASE}/api/admin/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        });
        
        const data = await response.json();
        
        if (data.success) {
          adminToken = data.token;
          document.getElementById('loginSection').style.display = 'none';
          document.getElementById('dashboardSection').style.display = 'block';
        } else {
          messageDiv.innerHTML = '<div class="error">âŒ Ø¨ÙŠØ§Ù†Ø§Øª Ø¯Ø®ÙˆÙ„ Ø®Ø§Ø·Ø¦Ø©</div>';
        }
      } catch (error) {
        messageDiv.innerHTML = '<div class="error">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…</div>';
        console.error('Ø®Ø·Ø£ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:', error);
      } finally {
        loginBtn.disabled = false;
        loginBtn.textContent = 'ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
      }
    }

    async function loadInstitutions() {
      const resultsDiv = document.getElementById('dashboardResults');
      resultsDiv.innerHTML = '<div style="color: #007bff; text-align: center;">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¤Ø³Ø³Ø§Øª...</div>';
      
      try {
        const response = await fetch(`${API_BASE}/api/admin/institutions`, {
          headers: { 'Authorization': `Bearer ${adminToken}` }
        });
        
        const data = await response.json();
        
        let html = '<div class="success"><h3>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¤Ø³Ø³Ø§Øª</h3>';
        html += '<div class="stats-grid">';
        html += `<div class="stat-card"><div class="stat-number">${data.summary.total}</div><div>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¤Ø³Ø³Ø§Øª</div></div>`;
        html += `<div class="stat-card"><div class="stat-number high-priority">${data.summary.highPriority}</div><div>Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</div></div>`;
        html += `<div class="stat-card"><div class="stat-number medium-priority">${data.summary.mediumPriority}</div><div>Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</div></div>`;
        html += `<div class="stat-card"><div class="stat-number low-priority">${data.summary.lowPriority}</div><div>Ù…Ù†Ø®ÙØ¶Ø© Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</div></div>`;
        html += '</div></div>';
        
        html += '<h3>ğŸ¢ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¤Ø³Ø³Ø§Øª:</h3><div class="institution-list">';
        data.institutions.forEach(inst => {
          const bgColor = inst.priority === 'Ø¹Ø§Ù„ÙŠØ©' ? '#e74c3c' : 
                          inst.priority === 'Ù…ØªÙˆØ³Ø·Ø©' ? '#f39c12' : '#27ae60';
          html += `<div class="institution-item" style="background: ${bgColor};">`;
          html += `${inst.name} - Ù†Ø²Ø§Ù‡Ø©: ${inst.integrityScore}% - Ø£ÙˆÙ„ÙˆÙŠØ©: ${inst.priority}`;
          html += `</div>`;
        });
        html += '</div>';
        
        resultsDiv.innerHTML = html;
      } catch (error) {
        resultsDiv.innerHTML = '<div class="error">âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>';
        console.error('Ø®Ø·Ø£ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¤Ø³Ø³Ø§Øª:', error);
      }
    }

    async function testAPI() {
      const resultsDiv = document.getElementById('dashboardResults');
      resultsDiv.innerHTML = '<div style="color: #007bff; text-align: center;">â³ Ø§Ø®ØªØ¨Ø§Ø± Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…...</div>';
      
      try {
        const response = await fetch(`${API_BASE}/health`);
        const data = await response.json();
        
        resultsDiv.innerHTML = `
          <div class="success">
            <h3>âœ… Ù†ØªØ§Ø¦Ø¬ ÙØ­Øµ Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
            <p><strong>Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø§Ø¯Ù…:</strong> ${data.ok ? 'âœ… Ù…Ù…ØªØ§Ø²' : 'âŒ Ø®Ø·Ø£'}</p>
            <p><strong>Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ:</strong> ${data.aiEnabled ? 'ğŸ¤– Ù…ÙØ¹Ù„' : 'âŒ Ù…Ø¹Ø·Ù„'}</p>
            <p><strong>Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:</strong> ${data.mongoConnected ? 'ğŸ—„ï¸ Ù…ØªØµÙ„Ø©' : 'âŒ Ù…Ù†Ù‚Ø·Ø¹Ø©'}</p>
            <p><strong>ÙˆÙ‚Øª Ø§Ù„ÙØ­Øµ:</strong> ${new Date().toLocaleString('ar')}</p>
            <p style="color: #27ae60; font-weight: bold;">ğŸ‰ Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ø¨ÙƒÙØ§Ø¡Ø© Ø¹Ø§Ù„ÙŠØ©!</p>
          </div>
        `;
      } catch (error) {
        resultsDiv.innerHTML = '<div class="error">âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…</div>';
      }
    }

    function showSystemInfo() {
      document.getElementById('dashboardResults').innerHTML = `
        <div class="success">
          <h3>ğŸ’¡ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù†Ø¸Ø§Ù… RedLight AI</h3>
          <p><strong>ğŸ¯ Ø§Ù„Ù‡Ø¯Ù:</strong> Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù†Ø²Ø§Ù‡Ø© ÙÙŠ Ø§Ù„Ù…Ø¤Ø³Ø³Ø§Øª Ø§Ù„Ø­ÙƒÙˆÙ…ÙŠØ© Ø§Ù„Ø£Ø±Ø¯Ù†ÙŠØ©</p>
          <p><strong>ğŸ¤– Ø§Ù„ØªÙ‚Ù†ÙŠØ©:</strong> Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…ØªÙ‚Ø¯Ù… + ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</p>
          <p><strong>ğŸ“Š Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª:</strong> Ù…Ø¤Ø´Ø±Ø§Øª Ù†Ø²Ø§Ù‡Ø© Ø¯Ù‚ÙŠÙ‚Ø© ÙˆÙ…ÙˆØ¶ÙˆØ¹ÙŠØ©</p>
          <p><strong>ğŸ† Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²:</strong> Ø£ÙˆÙ„ Ù†Ø¸Ø§Ù… Ù…Ù† Ù†ÙˆØ¹Ù‡ ÙÙŠ Ø§Ù„Ø£Ø±Ø¯Ù†</p>
          <p><strong>ğŸš€ Ø§Ù„Ø­Ø§Ù„Ø©:</strong> Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØ§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠ</p>
          <p><strong>ğŸ“ˆ Ø§Ù„Ù‚ÙŠÙ…Ø©:</strong> Ø­Ù„ Ø¹Ù…Ù„ÙŠ Ù„ØªØ¹Ø²ÙŠØ² Ø§Ù„Ø´ÙØ§ÙÙŠØ© ÙˆÙ…ÙƒØ§ÙØ­Ø© Ø§Ù„ÙØ³Ø§Ø¯</p>
        </div>
      `;
    }

    function logout() {
      adminToken = null;
      document.getElementById('loginSection').style.display = 'block';
      document.getElementById('dashboardSection').style.display = 'none';
      document.getElementById('dashboardResults').innerHTML = '';
      document.getElementById('loginMessage').innerHTML = '';
      document.getElementById('username').value = '';
      document.getElementById('password').value = '';
    }

    // Ø¥Ø¶Ø§ÙØ© ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Enter
    document.addEventListener('keypress', function(e) {
      if (e.key === 'Enter' && document.getElementById('loginSection').style.display !== 'none') {
        login();
      }
    });
  </script>
</body>
</html>
